{
  "kind": "build_request",
  "title": "Fix agent registry mutability in backend",
  "priority": "high",
  "requirements": [
    {
      "id": "REQ-1",
      "text": "Change the agents map declaration in backend/main.mo from 'let agents = Map.empty<Nat, Agent>();' to 'var agents = Map.empty<Nat, Agent>();' to make it mutable",
      "target": "backend",
      "source": {
        "messageIds": [
          "msg-4"
        ],
        "quotes": [
          "Find the declaration: let agents = Map.empty<Nat, Agent>(); Change it to be mutable: var agents = Map.empty<Nat, Agent>();"
        ]
      },
      "acceptanceCriteria": [
        "The agents map is declared with 'var' instead of 'let'",
        "The map can be reassigned during runtime"
      ]
    },
    {
      "id": "REQ-2",
      "text": "In the toggleAgentStatus function in backend/main.mo, explicitly reassign the updated map to the agents state variable using 'agents := agents.put(agent.id, updatedAgent);' or equivalent syntax for the Map library",
      "target": "backend",
      "source": {
        "messageIds": [
          "msg-4"
        ],
        "quotes": [
          "In toggleAgentStatus, ensure the updated map is explicitly reassigned to the state variable. For example: agents := agents.put(agent.id, updatedAgent);"
        ]
      },
      "acceptanceCriteria": [
        "The toggleAgentStatus function reassigns the agents variable after updating",
        "Agent status changes persist after the function completes",
        "Kill switch toggles maintain their state across function calls"
      ]
    }
  ],
  "constraints": [
    "Do NOT modify ANY frontend files - the React UI is stable and should not be touched",
    "Only modify backend/main.mo",
    "Preserve all existing backend functionality and data structures"
  ],
  "nonGoals": [
    "Changing the frontend components",
    "Modifying the UI behavior or styling",
    "Altering the Map library choice or data structure beyond mutability"
  ],
  "imageRequirements": {
    "required": [],
    "edits": []
  }
}