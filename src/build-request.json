{
  "kind": "build_request",
  "title": "Fix telemetry actor initialization in useActor hook",
  "projectName": "The Gang",
  "priority": "high",
  "requirements": [
    {
      "id": "REQ-1",
      "text": "Add a new useEffect hook in frontend/src/hooks/useActor.ts to initialize the telemetry actor connection. The hook must dynamically import the telemetry declarations module, create the actor using process.env.CANISTER_ID_TELEMETRY or the module's canisterId as fallback, pass identity-based agentOptions when identity exists, call setTelemetryActor with the created actor instance, handle errors with console.warn for offline telemetry, and trigger only when actorQuery.data is available. Position this new useEffect immediately above the existing useEffect that contains invalidateQueries logic.",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-7"
        ],
        "quotes": [
          "There is a bug in frontend/src/hooks/useActor.ts. We added telemetryActor to state, but we forgot to actually initialize the connection, so it remains null.",
          "Right ABOVE that existing useEffect, insert a NEW useEffect block"
        ]
      },
      "acceptanceCriteria": [
        "The telemetry actor is successfully initialized using dynamic import of ../../../declarations/telemetry",
        "The actor uses process.env.CANISTER_ID_TELEMETRY with telemetryModule.canisterId as fallback",
        "Identity-based agentOptions are passed when identity exists",
        "setTelemetryActor is called with the created actor instance",
        "Errors are caught and logged with console.warn('Telemetry offline:', e)",
        "The useEffect depends on [actorQuery.data, identity]",
        "The new useEffect is positioned above the existing invalidateQueries useEffect",
        "The telemetryActor state is no longer null after initialization"
      ]
    }
  ],
  "constraints": [
    "Do not modify backend/main.mo",
    "Do not touch the main actorQuery logic in useActor.ts",
    "Position the new useEffect above the existing invalidateQueries useEffect"
  ],
  "nonGoals": [
    "Refactoring other parts of the useActor hook",
    "Modifying telemetry backend logic",
    "Changing the telemetry state interface"
  ],
  "imageRequirements": {
    "required": [],
    "edits": []
  }
}