{
  "kind": "build_request",
  "title": "Fix silent actor crash and eliminate duplicate guard clauses",
  "priority": "high",
  "requirements": [
    {
      "id": "REQ-159",
      "text": "In the file managing Auth Context (frontend/src/hooks/useInternetIdentity.ts or the AuthProvider component), wrap the createActor logic in a strict try/catch block. In the try block, execute: const actor = createActor(canisterId, { agentOptions: { identity: authClient.getIdentity() } }); setBackend(actor);. In the catch block, log the error using console.error('ACTOR CREATION FAILED:', error); to prevent silent failures and provide visibility into initialization errors.",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-latest"
        ],
        "quotes": [
          "Wrap your createActor logic in a strict try/catch block so it doesn't fail silently.",
          "console.error(\"ACTOR CREATION FAILED:\", error);"
        ]
      },
      "acceptanceCriteria": [
        "createActor call is wrapped in try/catch block",
        "Errors are logged to console with 'ACTOR CREATION FAILED:' prefix",
        "Backend actor state is set successfully in try block on success"
      ]
    },
    {
      "id": "REQ-160",
      "text": "In the Auth Context file (frontend/src/hooks/useInternetIdentity.ts or AuthProvider), verify that the import statement for createActor and canisterId points to the correct local declarations folder. The import must use the exact path to the generated backend declarations, typically: import { createActor, canisterId } from '../../declarations/backend'; or the equivalent correct path for this project structure.",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-latest"
        ],
        "quotes": [
          "CRITICAL: Verify your import for createActor and canisterId is pointing to the correct local declarations folder."
        ]
      },
      "acceptanceCriteria": [
        "Import statement references correct declarations path",
        "createActor and canisterId are successfully imported",
        "No module resolution errors occur"
      ]
    },
    {
      "id": "REQ-161",
      "text": "In the main layout component (frontend/src/App.tsx), locate and DELETE ALL guard clauses that check backend initialization status (!backend) or authentication loading state (isLoading). The main App.tsx layout must NOT render any loading spinners, 'Connecting...' messages, or error screens itself. The layout should ONLY render the Header/Navbar component and the main content area (routing/tabs).",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-latest"
        ],
        "quotes": [
          "DELETE ALL if (!backend) or if (isLoading) guard clauses from the main layout.",
          "The layout should ONLY render the Header/Navbar and the main content area (routing/tabs). It should not render any loading spinners or error messages itself."
        ]
      },
      "acceptanceCriteria": [
        "No if (!backend) guard clauses exist in App.tsx main render",
        "No if (isLoading) guard clauses exist in App.tsx main render",
        "Header/Navbar always renders regardless of backend or auth state",
        "Only the tab content area shows conditional loading states"
      ]
    },
    {
      "id": "REQ-162",
      "text": "In the Boardroom component (within frontend/src/App.tsx or a separate Boardroom component file), implement strict early return pattern at the very top of the component render function in this exact order: (1) if (isLoading) return <div className=\"mt-10 text-center text-green-500\">Checking session...</div>; (2) if (!isAuthenticated) return <div className=\"mt-10 text-center text-yellow-500\">Please authenticate.</div>; (3) if (!backend) return <div className=\"mt-10 text-center text-red-500\">Actor missing. Check console for errors.</div>; (4) return the main Boardroom UI. These early returns must be the ONLY conditional rendering logic in the component.",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-latest"
        ],
        "quotes": [
          "ensure the strict return pattern is at the very top of the component:\nif (isLoading) return <div className=\"mt-10 text-center text-green-500\">Checking session...</div>;\nif (!isAuthenticated) return <div className=\"mt-10 text-center text-yellow-500\">Please authenticate.</div>;\nif (!backend) return <div className=\"mt-10 text-center text-red-500\">Actor missing. Check console for errors.</div>;"
        ]
      },
      "acceptanceCriteria": [
        "Exactly three early return statements exist at the top of Boardroom component",
        "Return order is: isLoading, !isAuthenticated, !backend",
        "Only ONE message displays at any given time",
        "Main UI only renders when all three conditions pass"
      ]
    },
    {
      "id": "REQ-163",
      "text": "In the SwarmHealth component (within frontend/src/App.tsx or a separate SwarmHealth component file), implement strict early return pattern at the very top of the component render function in this exact order: (1) if (isLoading) return <div className=\"mt-10 text-center text-green-500\">Checking session...</div>; (2) if (!isAuthenticated) return <div className=\"mt-10 text-center text-yellow-500\">Please authenticate.</div>; (3) if (!backend) return <div className=\"mt-10 text-center text-red-500\">Actor missing. Check console for errors.</div>; (4) return the main SwarmHealth UI. These early returns must be the ONLY conditional rendering logic in the component.",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-latest"
        ],
        "quotes": [
          "In Boardroom, SwarmHealth, and SensoryCortex, ensure the strict return pattern is at the very top of the component"
        ]
      },
      "acceptanceCriteria": [
        "Exactly three early return statements exist at the top of SwarmHealth component",
        "Return order is: isLoading, !isAuthenticated, !backend",
        "Only ONE message displays at any given time",
        "Main UI only renders when all three conditions pass"
      ]
    },
    {
      "id": "REQ-164",
      "text": "In the SensoryCortex component (within frontend/src/App.tsx or frontend/src/components/SensoryCortexTab.tsx), implement strict early return pattern at the very top of the component render function in this exact order: (1) if (isLoading) return <div className=\"mt-10 text-center text-green-500\">Checking session...</div>; (2) if (!isAuthenticated) return <div className=\"mt-10 text-center text-yellow-500\">Please authenticate.</div>; (3) if (!backend) return <div className=\"mt-10 text-center text-red-500\">Actor missing. Check console for errors.</div>; (4) return the main SensoryCortex UI. These early returns must be the ONLY conditional rendering logic in the component.",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-latest"
        ],
        "quotes": [
          "In Boardroom, SwarmHealth, and SensoryCortex, ensure the strict return pattern is at the very top of the component"
        ]
      },
      "acceptanceCriteria": [
        "Exactly three early return statements exist at the top of SensoryCortex component",
        "Return order is: isLoading, !isAuthenticated, !backend",
        "Only ONE message displays at any given time",
        "Main UI only renders when all three conditions pass"
      ]
    }
  ],
  "constraints": [
    "Do not change the backend main.mo file",
    "Header/Navbar must always render regardless of backend or authentication state",
    "Only ONE loading/error message must display at any time",
    "Early return pattern order must be: isLoading, !isAuthenticated, !backend"
  ],
  "nonGoals": [
    "Implementing new authentication methods",
    "Changing the backend actor interface",
    "Modifying the debate logic or agent routing",
    "Adding new UI components beyond fixing existing ones"
  ],
  "imageRequirements": {
    "required": [],
    "edits": []
  }
}