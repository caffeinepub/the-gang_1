{
  "kind": "build_request",
  "title": "Restore Version 34 functionality",
  "projectName": "The Gang",
  "priority": "high",
  "requirements": [
    {
      "id": "REQ-167",
      "text": "In backend/main.mo, restore the start_boardroom_debate function to use dynamic agent routing logic that checks the Agent Registry is_enabled status for each agent (Skippy, GLaDOS, Robby). If an agent's is_enabled field is true, append their stubbed response to the transcript. If is_enabled is false, append the message '[Agent Name] is currently offline. Bypassing routing segment.' to the transcript.",
      "target": "backend",
      "source": {
        "messageIds": [
          "msg-user-restore-v34"
        ],
        "quotes": [
          "Restore the code to Version 34"
        ]
      },
      "acceptanceCriteria": [
        "start_boardroom_debate checks agent.is_enabled before appending each agent's response",
        "Offline agents show 'is currently offline. Bypassing...' message in transcript",
        "Online agents show their normal stubbed response in transcript"
      ]
    },
    {
      "id": "REQ-168",
      "text": "In frontend/src/App.tsx, remove the setTranscript([]) call from the handlePushToTalk function that clears the transcript at the start of each recording. The transcript should persist across multiple Push-to-Talk sessions and accumulate agent responses without being reset.",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-user-restore-v34"
        ],
        "quotes": [
          "Restore the code to Version 34"
        ]
      },
      "acceptanceCriteria": [
        "setTranscript([]) is removed from the Push-to-Talk handler",
        "Transcript content persists across multiple recordings",
        "New agent responses append to existing transcript without clearing"
      ]
    },
    {
      "id": "REQ-169",
      "text": "In frontend/src/App.tsx, remove the try/catch/finally error handling wrapper from the backend.start_boardroom_debate() call in the handlePushToTalk function. The function should call backend.start_boardroom_debate() directly without explicit error boundaries.",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-user-restore-v34"
        ],
        "quotes": [
          "Restore the code to Version 34"
        ]
      },
      "acceptanceCriteria": [
        "try/catch/finally block is removed from the debate call",
        "backend.start_boardroom_debate() executes without error wrapper",
        "No finally block that resets loading state variables"
      ]
    },
    {
      "id": "REQ-170",
      "text": "In frontend/src/hooks/useQueries.ts or frontend/src/App.tsx (wherever the debate status polling hook is defined), restore the useEffect dependency array for the speech recognition update logic to include the transcript state variable. The useEffect that manages SpeechSynthesis or transcript updates should have transcript in its dependency array.",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-user-restore-v34"
        ],
        "quotes": [
          "Restore the code to Version 34"
        ]
      },
      "acceptanceCriteria": [
        "useEffect dependency array includes transcript variable",
        "Speech synthesis triggers properly when transcript updates",
        "Component responds to transcript changes as expected"
      ]
    },
    {
      "id": "REQ-171",
      "text": "In frontend/src/App.tsx, change the Push-to-Talk button onClick handler to use direct function reference syntax (onClick={handleSpeech}) instead of arrow function syntax (onClick={() => handleSpeech()}). The button should trigger the handler directly without wrapping it in an arrow function.",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-user-restore-v34"
        ],
        "quotes": [
          "Restore the code to Version 34"
        ]
      },
      "acceptanceCriteria": [
        "Button uses onClick={handleSpeech} syntax",
        "Arrow function wrapper is removed",
        "Handler executes when button is clicked"
      ]
    }
  ],
  "constraints": [
    "Do not modify the Agent Registry structure or pre-populated agent data",
    "Preserve all existing authentication and actor initialization logic",
    "Keep all three tab navigation components (Boardroom, Sensory Cortex, Swarm Health) intact"
  ],
  "nonGoals": [
    "Fixing React Error 185 infinite loop",
    "Adding error handling for backend call failures",
    "Preventing button stuck states with finally blocks",
    "Clearing transcript between recordings"
  ],
  "imageRequirements": {
    "required": [],
    "edits": []
  }
}